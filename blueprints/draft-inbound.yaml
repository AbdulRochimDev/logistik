models:
  Supplier:
    code: string unique
    name: string
    contact_name: string nullable
    phone: string nullable
    email: string nullable
    address: text nullable
    relationships:
      hasMany: PurchaseOrder
  Warehouse:
    code: string unique
    name: string
    address: text nullable
    relationships:
      hasMany: Location
      hasMany: PurchaseOrder
  Location:
    warehouse_id: id foreign
    code: string
    name: string
    type: string
    is_default: boolean default:false
    relationships:
      belongsTo: Warehouse
  Item:
    sku: string unique
    name: string
    description: text nullable
    default_uom: string
    is_lot_tracked: boolean default:false
  ItemLot:
    item_id: id foreign
    lot_no: string
    production_date: date nullable
    expiry_date: date nullable

  PurchaseOrder:
    supplier_id: id foreign
    warehouse_id: id foreign
    po_no: string unique
    status: enum:draft,approved,closed default:draft
    eta: date nullable
    notes: text nullable
    created_by: id foreign:users
    approved_by: id foreign:users nullable
    relationships:
      hasMany: PoItem
      hasOne: InboundShipment
  PoItem:
    purchase_order_id: id foreign
    item_id: id foreign
    uom: string
    ordered_qty: decimal:16,3
    received_qty: decimal:16,3 default:0
  InboundShipment:
    purchase_order_id: id foreign
    asn_no: string nullable
    status: enum:scheduled,arrived,received,closed default:scheduled
    scheduled_at: datetime nullable
    remarks: text nullable
    relationships:
      hasMany: GrnHeader
  GrnHeader:
    inbound_shipment_id: id foreign
    grn_no: string unique
    received_at: datetime
    status: enum:draft,posted,void default:draft
    received_by: id foreign:users
    verified_by: id foreign:users nullable
    notes: text nullable
    relationships:
      hasMany: GrnLine
  GrnLine:
    grn_header_id: id foreign
    po_item_id: id foreign
    item_lot_id: id foreign nullable
    putaway_location_id: id foreign:locations nullable
    received_qty: decimal:16,3
    rejected_qty: decimal:16,3 default:0
    uom: string

controllers:
  Admin/Inbound/PurchaseOrderController:
    resource: api
    store:
      validate: supplier_id, warehouse_id, po_no, eta, notes
    update:
      validate: status, eta, notes
    destroy:
      policy: delete
  Admin/Inbound/GrnController:
    resource: api
    store:
      validate: inbound_shipment_id, received_at, status
    post:
      method: post
      uri: grn/{grn_header}/post
      uses: Admin\\Inbound\\GrnController@post
      validate: received_at
  Admin/Inbound/PutawayController:
    store:
      validate: grn_line_id, to_location_id, qty

seeders:
  Supplier
  Warehouse
  Item

factories:
  Supplier
  Warehouse
  Item
  PurchaseOrder
  PoItem
  InboundShipment
  GrnHeader
  GrnLine
